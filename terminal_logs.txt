PS D:\Learn\Kaggle Competition\Road-Buddy-Challenge> python main.py --evaluate --model "Qwen/Qwen2-VL-2B-Instruct" --backend transformers --max_samples 10
2026-01-30 09:11:44,546 - src.perception.query_analyzer.analyzer - INFO - QueryAnalyzer initialized with strategy: keyword
2026-01-30 09:11:44,759 - src.perception.frame_scorer - INFO - Translation enabled for Vietnamese -> English (deep_translator)
2026-01-30 09:11:44,759 - src.perception.keyframe_selector - INFO - KeyframeSelector initialized: query=keyword, scoring=clip, selection=diverse_top_k, yolo_mode=none
2026-01-30 09:11:46,190 - src.reasoning.vlm_client - INFO - Loading Qwen/Qwen2-VL-2B-Instruct on cpu...
Using a slow image processor as `use_fast` is unset and a slow processor was saved with this model. `use_fast=True` will be the default behavior in v4.48, even if the model was saved with a slow processor. This will result in minor differences in outputs. You'll still be able to use a slow processor with `use_fast=False`.
Loading checkpoint shards: 100%|█████████████████████████████████████| 2/2 [00:13<00:00,  6.83s/it]
2026-01-30 09:12:05,080 - src.reasoning.vlm_client - WARNING - Running on CPU - inference will be slow
2026-01-30 09:12:05,081 - src.reasoning.vlm_client - INFO - Qwen/Qwen2-VL-2B-Instruct loaded successfully on cpu
2026-01-30 09:12:05,082 - __main__ - INFO - Pipeline initialized: keyframes=8, model=Qwen/Qwen2-VL-2B-Instruct
Selecting Keyframes:   0%|                                                  | 0/10 [00:00<?, ?it/s]2026-01-30 09:12:06,574 - src.perception.keyframe_selector - INFO - Analyzing question: Nếu xe ô tô đang chạy ở làn ngoài cùng bên phải tr...
2026-01-30 09:12:06,574 - src.perception.keyframe_selector - INFO - Query analysis: targets=['car', 'direction_right', 'right_turn', 'rightmost_lane', 'automobile'], intent=permission
2026-01-30 09:12:06,574 - src.perception.keyframe_selector - INFO - Sampling frames from: data\raw\train\videos\2b840c67_386_clip_002_0008_0018_Y.mp4
2026-01-30 09:12:06,910 - src.perception.keyframe_selector - INFO - Video: 300 frames, 30.0 FPS, 10.0s
2026-01-30 09:12:09,137 - src.perception.keyframe_selector - INFO - Sampled 20 frames from 10.0s video
2026-01-30 09:12:09,137 - src.perception.keyframe_selector - INFO - Scoring frames...
2026-01-30 09:12:09,163 - src.perception.frame_scorer - INFO - Computing Question-Frame Similarity scores...
2026-01-30 09:12:09,959 - src.perception.frame_scorer - INFO - Loading CLIP model: ViT-B/32
2026-01-30 09:12:13,685 - src.perception.frame_scorer - INFO - CLIP model loaded on cpu
2026-01-30 09:12:19,224 - src.perception.frame_scorer - INFO - Computing Inter-Frame Distinctiveness scores...
2026-01-30 09:12:19,444 - src.perception.keyframe_selector - INFO - Selecting 8 keyframes...
2026-01-30 09:12:19,599 - src.perception.keyframe_selector - INFO - Selected 8 keyframes in 13.03s
Selecting Keyframes:  10%|████▏                                     | 1/10 [00:13<01:57, 13.03s/it]2026-01-30 09:12:19,600 - src.perception.keyframe_selector - INFO - Analyzing question: Phần đường trong video cho phép các phương tiện đi...
2026-01-30 09:12:19,600 - src.perception.keyframe_selector - INFO - Query analysis: targets=['junction', 'intersection'], intent=permission  
2026-01-30 09:12:19,600 - src.perception.keyframe_selector - INFO - Sampling frames from: data\raw\train\videos\2b840c67_386_clip_002_0008_0018_Y.mp4
2026-01-30 09:12:19,816 - src.perception.keyframe_selector - INFO - Video: 300 frames, 30.0 FPS, 10.0s
2026-01-30 09:12:21,645 - src.perception.keyframe_selector - INFO - Sampled 20 frames from 10.0s video
2026-01-30 09:12:21,646 - src.perception.keyframe_selector - INFO - Scoring frames...
2026-01-30 09:12:21,646 - src.perception.frame_scorer - INFO - Computing Question-Frame Similarity scores...
2026-01-30 09:12:25,069 - src.perception.frame_scorer - INFO - Computing Inter-Frame Distinctiveness scores...
2026-01-30 09:12:25,224 - src.perception.keyframe_selector - INFO - Selecting 8 keyframes...
2026-01-30 09:12:25,369 - src.perception.keyframe_selector - INFO - Selected 8 keyframes in 5.77s
Selecting Keyframes:  20%|████████▍                                 | 2/10 [00:18<01:10,  8.76s/it]2026-01-30 09:12:25,370 - src.perception.keyframe_selector - INFO - Analyzing question: Biển chỉ dẫn 3 hướng di chuyển chính tiếp theo, đú...
2026-01-30 09:12:25,370 - src.perception.keyframe_selector - INFO - Query analysis: targets=['direction_sign', 'guide_sign'], intent=comparison
2026-01-30 09:12:25,370 - src.perception.keyframe_selector - INFO - Sampling frames from: data\raw\train\videos\fe716b14_386_clip_003_0018_0024_N.mp4
2026-01-30 09:12:25,568 - src.perception.keyframe_selector - INFO - Video: 180 frames, 30.0 FPS, 6.0s
2026-01-30 09:12:26,505 - src.perception.keyframe_selector - INFO - Sampled 12 frames from 6.0s video
2026-01-30 09:12:26,506 - src.perception.keyframe_selector - INFO - Scoring frames...
2026-01-30 09:12:26,506 - src.perception.frame_scorer - INFO - Computing Question-Frame Similarity scores...
2026-01-30 09:12:28,676 - src.perception.frame_scorer - INFO - Computing Inter-Frame Distinctiveness scores...
2026-01-30 09:12:28,792 - src.perception.keyframe_selector - INFO - Selecting 8 keyframes...
2026-01-30 09:12:28,902 - src.perception.keyframe_selector - INFO - Selected 8 keyframes in 3.53s
Selecting Keyframes:  30%|████████████▌                             | 3/10 [00:22<00:44,  6.37s/it]2026-01-30 09:12:28,903 - src.perception.keyframe_selector - INFO - Analyzing question: Theo biển báo trong video, muốn đi đến đường Lương...
2026-01-30 09:12:28,903 - src.perception.keyframe_selector - INFO - Query analysis: targets=['traffic_sign'], intent=direction
2026-01-30 09:12:28,903 - src.perception.keyframe_selector - INFO - Sampling frames from: data\raw\train\videos\d02ce0c1_386_clip_004_0024_0032_N.mp4
2026-01-30 09:12:29,128 - src.perception.keyframe_selector - INFO - Video: 240 frames, 30.0 FPS, 8.0s
2026-01-30 09:12:30,361 - src.perception.keyframe_selector - INFO - Sampled 16 frames from 8.0s video
2026-01-30 09:12:30,361 - src.perception.keyframe_selector - INFO - Scoring frames...
2026-01-30 09:12:30,361 - src.perception.frame_scorer - INFO - Computing Question-Frame Similarity scores...
2026-01-30 09:12:33,416 - src.perception.frame_scorer - INFO - Computing Inter-Frame Distinctiveness scores...
2026-01-30 09:12:33,589 - src.perception.keyframe_selector - INFO - Selecting 8 keyframes...
2026-01-30 09:12:33,744 - src.perception.keyframe_selector - INFO - Selected 8 keyframes in 4.84s
Selecting Keyframes:  40%|████████████████▊                         | 4/10 [00:27<00:34,  5.77s/it]2026-01-30 09:12:33,745 - src.perception.keyframe_selector - INFO - Analyzing question: Làn đường di chuyển hiện tại có được rẽ phải không...
2026-01-30 09:12:33,745 - src.perception.keyframe_selector - INFO - Query analysis: targets=['direction_right', 'right_turn', 'lane_marking', 'lane'], intent=temporal
2026-01-30 09:12:33,745 - src.perception.keyframe_selector - INFO - Sampling frames from: data\raw\train\videos\2339ba19_386_clip_005_0032_0039_Y.mp4
2026-01-30 09:12:33,870 - src.perception.keyframe_selector - INFO - Video: 210 frames, 30.0 FPS, 7.0s
2026-01-30 09:12:34,934 - src.perception.keyframe_selector - INFO - Sampled 14 frames from 7.0s video
2026-01-30 09:12:34,935 - src.perception.keyframe_selector - INFO - Scoring frames...
2026-01-30 09:12:34,935 - src.perception.frame_scorer - INFO - Computing Question-Frame Similarity scores...
2026-01-30 09:12:40,109 - src.perception.frame_scorer - INFO - Computing Inter-Frame Distinctiveness scores...
2026-01-30 09:12:40,397 - src.perception.keyframe_selector - INFO - Selecting 8 keyframes...
2026-01-30 09:12:40,603 - src.perception.keyframe_selector - INFO - Selected 8 keyframes in 6.86s
Selecting Keyframes:  50%|█████████████████████                     | 5/10 [00:34<00:30,  6.16s/it]2026-01-30 09:12:40,604 - src.perception.keyframe_selector - INFO - Analyzing question: Làn đường xe đang chạy có được phép rẽ trái hay kh...
2026-01-30 09:12:40,604 - src.perception.keyframe_selector - INFO - Query analysis: targets=['direction_left', 'left_turn', 'lane_marking', 'lane'], intent=permission
2026-01-30 09:12:40,605 - src.perception.keyframe_selector - INFO - Sampling frames from: data\raw\train\videos\464458b4_386_clip_006_0039_0048_Y.mp4
2026-01-30 09:12:40,937 - src.perception.keyframe_selector - INFO - Video: 270 frames, 30.0 FPS, 9.0s
2026-01-30 09:12:43,668 - src.perception.keyframe_selector - INFO - Sampled 18 frames from 9.0s video
2026-01-30 09:12:43,669 - src.perception.keyframe_selector - INFO - Scoring frames...
2026-01-30 09:12:43,669 - src.perception.frame_scorer - INFO - Computing Question-Frame Similarity scores...
2026-01-30 09:12:47,872 - src.perception.frame_scorer - INFO - Computing Inter-Frame Distinctiveness scores...
2026-01-30 09:12:48,072 - src.perception.keyframe_selector - INFO - Selecting 8 keyframes...
2026-01-30 09:12:48,279 - src.perception.keyframe_selector - INFO - Selected 8 keyframes in 7.67s
Selecting Keyframes:  60%|█████████████████████████▏                | 6/10 [00:41<00:26,  6.68s/it]2026-01-30 09:12:48,279 - src.perception.keyframe_selector - INFO - Analyzing question: Trong video muốn đi Cầu Rạch Chiếc thì cần rẽ phải...
2026-01-30 09:12:48,280 - src.perception.keyframe_selector - INFO - Query analysis: targets=['direction_right', 'right_turn'], intent=comparison
2026-01-30 09:12:48,280 - src.perception.keyframe_selector - INFO - Sampling frames from: data\raw\train\videos\e42e5037_386_clip_007_0048_0053_N.mp4
2026-01-30 09:12:48,455 - src.perception.keyframe_selector - INFO - Video: 150 frames, 30.0 FPS, 5.0s
2026-01-30 09:12:49,294 - src.perception.keyframe_selector - INFO - Sampled 10 frames from 5.0s video
2026-01-30 09:12:49,295 - src.perception.keyframe_selector - INFO - Scoring frames...
2026-01-30 09:12:49,295 - src.perception.frame_scorer - INFO - Computing Question-Frame Similarity scores...
2026-01-30 09:12:51,913 - src.perception.frame_scorer - INFO - Computing Inter-Frame Distinctiveness scores...
2026-01-30 09:12:52,021 - src.perception.keyframe_selector - INFO - Selecting 8 keyframes...
2026-01-30 09:12:52,126 - src.perception.keyframe_selector - INFO - Selected 8 keyframes in 3.85s
Selecting Keyframes:  70%|█████████████████████████████▍            | 7/10 [00:45<00:17,  5.75s/it]2026-01-30 09:12:52,126 - src.perception.keyframe_selector - INFO - Analyzing question: Trong video, nếu xe oto đang ở làn bên phải trong ...
2026-01-30 09:12:52,126 - src.perception.keyframe_selector - INFO - Query analysis: targets=[], intent=direction
2026-01-30 09:12:52,127 - src.perception.keyframe_selector - INFO - Sampling frames from: data\raw\train\videos\e42e5037_386_clip_007_0048_0053_N.mp4
2026-01-30 09:12:52,177 - src.perception.keyframe_selector - INFO - Video: 150 frames, 30.0 FPS, 5.0s
2026-01-30 09:12:52,880 - src.perception.keyframe_selector - INFO - Sampled 10 frames from 5.0s video
2026-01-30 09:12:52,880 - src.perception.keyframe_selector - INFO - Scoring frames...
2026-01-30 09:12:52,880 - src.perception.frame_scorer - INFO - Computing Question-Frame Similarity scores...
2026-01-30 09:12:54,878 - src.perception.frame_scorer - INFO - Computing Inter-Frame Distinctiveness scores...
2026-01-30 09:12:54,976 - src.perception.keyframe_selector - INFO - Selecting 8 keyframes...
2026-01-30 09:12:55,072 - src.perception.keyframe_selector - INFO - Selected 8 keyframes in 2.95s
Selecting Keyframes:  80%|█████████████████████████████████▌        | 8/10 [00:48<00:09,  4.86s/it]2026-01-30 09:12:55,072 - src.perception.keyframe_selector - INFO - Analyzing question: Trong video, hướng đi Cầu Rạch Chiếc là hướng nào?...
2026-01-30 09:12:55,073 - src.perception.keyframe_selector - INFO - Query analysis: targets=['direction_sign', 'direction'], intent=direction
2026-01-30 09:12:55,073 - src.perception.keyframe_selector - INFO - Sampling frames from: data\raw\train\videos\e42e5037_386_clip_007_0048_0053_N.mp4
2026-01-30 09:12:55,118 - src.perception.keyframe_selector - INFO - Video: 150 frames, 30.0 FPS, 5.0s
2026-01-30 09:12:55,803 - src.perception.keyframe_selector - INFO - Sampled 10 frames from 5.0s video
2026-01-30 09:12:55,803 - src.perception.keyframe_selector - INFO - Scoring frames...
2026-01-30 09:12:55,803 - src.perception.frame_scorer - INFO - Computing Question-Frame Similarity scores...
2026-01-30 09:12:58,106 - src.perception.frame_scorer - INFO - Computing Inter-Frame Distinctiveness scores...
2026-01-30 09:12:58,203 - src.perception.keyframe_selector - INFO - Selecting 8 keyframes...
2026-01-30 09:12:58,293 - src.perception.keyframe_selector - INFO - Selected 8 keyframes in 3.22s
Selecting Keyframes:  90%|█████████████████████████████████████▊    | 9/10 [00:51<00:04,  4.35s/it]2026-01-30 09:12:58,325 - src.perception.keyframe_selector - INFO - Analyzing question: Nếu sẽ ô tô ở làn ngoài cùng bên trái thì có được ...
2026-01-30 09:12:58,332 - src.perception.keyframe_selector - INFO - Query analysis: targets=['car', 'go_straight', 'direction_straight', 'leftmost_lane', 'automobile'], intent=permission
2026-01-30 09:12:58,366 - src.perception.keyframe_selector - INFO - Sampling frames from: data\raw\train\videos\6e51484d_386_clip_008_0053_0060_N.mp4
2026-01-30 09:12:58,539 - src.perception.keyframe_selector - INFO - Video: 210 frames, 30.0 FPS, 7.0s
2026-01-30 09:12:59,438 - src.perception.keyframe_selector - INFO - Sampled 14 frames from 7.0s video
2026-01-30 09:12:59,439 - src.perception.keyframe_selector - INFO - Scoring frames...
2026-01-30 09:12:59,439 - src.perception.frame_scorer - INFO - Computing Question-Frame Similarity scores...
2026-01-30 09:13:03,884 - src.perception.frame_scorer - INFO - Computing Inter-Frame Distinctiveness scores...
2026-01-30 09:13:04,033 - src.perception.keyframe_selector - INFO - Selecting 8 keyframes...
2026-01-30 09:13:04,181 - src.perception.keyframe_selector - INFO - Selected 8 keyframes in 5.86s
Selecting Keyframes: 100%|█████████████████████████████████████████| 10/10 [00:57<00:00,  5.76s/it]
2026-01-30 09:13:04,182 - __main__ - INFO - Unloading perception models...
2026-01-30 09:13:04,182 - src.perception.keyframe_selector - INFO - Unloading perception models...
2026-01-30 09:13:04,182 - src.perception.frame_scorer - INFO - Unloading CLIP model...
2026-01-30 09:13:04,459 - src.perception.frame_scorer - INFO - CLIP model unloaded
2026-01-30 09:13:04,624 - src.perception.keyframe_selector - INFO - Perception models unloaded
2026-01-30 09:13:06,777 - __main__ - INFO - === Phase 2: VLM Generation ===
Generating Answers:   0%|                                                                                            | 0/10 [00:00<?, ?it/s]2026-01-30 09:13:06,802 - src.reasoning.vlm_client - INFO - Reduced frames from 4 to 4 to fit token limit
Generating Answers:  10%|████████▎                                                                          | 1/10 [01:57<17:33, 117.00s/it]2026-01-30 09:15:03,811 - src.reasoning.vlm_client - INFO - Reduced frames from 4 to 4 to fit token limit
Generating Answers:  20%|████████████████▊                                                                   | 2/10 [03:21<13:05, 98.16s/it]2026-01-30 09:16:28,783 - src.reasoning.vlm_client - INFO - Reduced frames from 4 to 4 to fit token limit
Generating Answers:  30%|█████████████████████████▏                                                          | 3/10 [05:04<11:39, 99.97s/it]2026-01-30 09:18:10,923 - src.reasoning.vlm_client - INFO - Reduced frames from 4 to 4 to fit token limit
Generating Answers:  40%|█████████████████████████████████▌                                                  | 4/10 [06:42<09:56, 99.34s/it]2026-01-30 09:19:49,504 - src.reasoning.vlm_client - INFO - Reduced frames from 4 to 4 to fit token limit
Generating Answers:  50%|█████████████████████████████████████████▌                                         | 5/10 [08:52<09:11, 110.33s/it]2026-01-30 09:21:59,109 - src.reasoning.vlm_client - INFO - Reduced frames from 4 to 4 to fit token limit
Generating Answers:  60%|█████████████████████████████████████████████████▊                                 | 6/10 [10:29<07:03, 105.92s/it]2026-01-30 09:23:36,481 - src.reasoning.vlm_client - INFO - Reduced frames from 4 to 4 to fit token limit
Generating Answers:  70%|██████████████████████████████████████████████████████████                         | 7/10 [12:18<05:20, 106.72s/it]2026-01-30 09:25:24,881 - src.reasoning.vlm_client - INFO - Reduced frames from 4 to 4 to fit token limit
Generating Answers:  80%|██████████████████████████████████████████████████████████████████▍                | 8/10 [14:05<03:33, 106.80s/it]2026-01-30 09:27:11,814 - src.reasoning.vlm_client - INFO - Reduced frames from 4 to 4 to fit token limit
Generating Answers:  90%|██████████████████████████████████████████████████████████████████████████▋        | 9/10 [15:46<01:45, 105.04s/it]2026-01-30 09:28:53,004 - src.reasoning.vlm_client - INFO - Reduced frames from 4 to 4 to fit token limit
Generating Answers: 100%|██████████████████████████████████████████████████████████████████████████████████| 10/10 [17:23<00:00, 104.39s/it]
Evaluation results
..................................................
Total Samples: 10
Correct: 7
Accuracy: 70.00%
Avg Processing Time: 104328.8 ms